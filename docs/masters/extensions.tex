% vim: spelllang=en spell textwidth=120
\documentclass[trojita]{subfiles}

\begin{document}

\chapter{IMAP Extensions}
\label{sec:imap-extensions}

\begin{abstract}
  Previous chapter has outlined the generic mode of operation of the IMAP protocol and provided an overview of what
  features are available.  In this chapter, we will talk about how to improve on the basic functionality through the
  optional extensions.
\end{abstract}

It might be concluded from the brief analysis presented in the previous chapter that a few feature of IMAP are rather
limiting in its real-world deployment.  Fortunately, the IMAP protocol includes built-in support of extensions which
allow rather substantial changes to the network communication.

\section{Optimizing the Protocol}

Before dwelling into more advanced topics like improving the synchronization performance or adding new features, let's
have a look at the basic layer of the IMAP protocol and investigate how these affect performance.

\subsection{The LITERAL+ Extension}
\label{sec:imap-literalplus}

One of the lowest-hanging optimization fruit to cater are IMAP's synchronizing literals.  In the basic IMAP, before a
clients proceeds with tasks involving upload of binary data (or any data over a certain size, for that matter), it has
to ask for an explicit server's approval based on the length of the data in question.  As we have shown previously, this
confirmation imposes a full round trip over the network, inducing latency and destroying any potential pipelining
improvements.

The LITERAL+ extension~\cite{rfc2088} simply lifts the requirement of having to wait for the server's continuation
requests by a subtle change of the syntax.  Adding an overhead of just one byte, the latency is completely eliminated
and communication gets rapidly streamlined.  We can go as far as to say that the code paths for dealing with LITERAL+
data are actually simpler than having to deal with the old-fashioned synchronizing literals.  Consider the following
example:

\begin{minted}{text}
  S: * OK
  C: A001 LOGIN {11}
  # The client has to wait for server's response before proceeding any further
  S: + go ahead
  C: FRED FOOBAR {7}
  # A second round-trip wait occurs here
  S: + go ahead
  C: fat man
  S: A001 OK LOGIN completed
\end{minted}

When using the LITERAL+ syntax, the whole interaction happens without having to wait for the server:

\begin{minted}{text}
  S: * OK
  C: A001 LOGIN {11+}
  C: FRED FOOBAR {7+}
  C: fat man
  S: A001 OK LOGIN completed
\end{minted}

Trojit√° includes full support for the LITERAL+ extension -- when it detects the {\tt LITERAL+} capability, it will
immediately switch to using non-synchronizing literals for increased performance.

\subsection{Data Compression}

\cite{rfc4978}

\subsection{Improving Security through Cryptography}

\cite{rfc2595}

\subsection{The IDLE Mode}
\label{sec:imap-idle}

\cite{rfc2177}

\section{Improving Mailbox Synchronization}

\subsection{The ESEARCH Extension}

\cite{rfc4731}

\subsection{Avoiding Flags Resynchronization via CONDSTORE}

\cite{rfc4551}

\subsection{Optimizing UID Synchronization with QRESYNC}

\cite{rfc5162}

\section{Fetching the Data}

\subsection{The BINARY Extension}

\cite{rfc3516}

\subsection{Server-side Conversions via CONVERT}

\cite{rfc5259}

\section{Updating Mailboxes}

\subsection{Sorting, Searching  and Threading}

\cite{rfc5256}
\cite{rfc5957}

\subsection{Incremental Sorting and Searching}

\cite{rfc5267}

\subsection{Refreshing Statistics}

\cite{rfc5465}

\section{Further Improvements}

\subsection{Debugging}

\subsection{Sending Mail}

\end{document}
